"use strict";

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Item = function () {
    function Item(item) {
        _classCallCheck(this, Item);

        for (var attr in item) {
            this[attr] = item[attr];
        }

        //TODO Extract to methods
        /**image */
        var img = document.createElement("img");
        img.setAttribute("src", this.imageName);
        img.setAttribute("alt", 'Imagem produto');
        var divImg = document.createElement("div");
        divImg.classList.add("item__image");
        divImg.appendChild(img);

        /**title/name */
        var divTitle = document.createElement("div");
        divTitle.classList.add("item__title");
        divTitle.innerHTML = this.name;

        /**oldPrice */
        var divOldPrice = document.createElement("div");
        divOldPrice.classList.add("item__oldPrice");
        var spanOldPrice = document.createElement("span");
        spanOldPrice.innerHTML = this.oldPrice;
        divOldPrice.innerHTML = "De: ";
        divOldPrice.appendChild(spanOldPrice);

        /**price and conditions */
        var divPrice = document.createElement("div");
        divPrice.classList.add("item__price");
        var spanPrice = document.createElement("span");
        spanPrice.innerHTML = this.price;
        var divPriceConditions = document.createElement("div");
        divPriceConditions.classList.add("item__price__conditions");
        divPriceConditions.innerHTML = this.productInfo.paymentConditions;
        divPrice.innerHTML = "Por: ";
        divPrice.appendChild(spanPrice);
        divPrice.appendChild(divPriceConditions);

        /**div .item */
        var divItem = document.createElement("div");
        divItem.classList.add("item");
        divItem.appendChild(divImg);
        divItem.appendChild(divTitle);
        divItem.appendChild(divOldPrice);
        divItem.appendChild(divPrice);

        /**item url and container element */
        this.itemElem = document.createElement("a");
        this.itemElem.classList.add("hidden");
        this.itemElem.setAttribute("href", this.detailUrl);
        this.itemElem.setAttribute("target", "_blank");
        this.itemElem.appendChild(divItem);
    }

    _createClass(Item, [{
        key: "show",
        value: function show() {
            this.itemElem.classList.remove("hidden");
        }
    }, {
        key: "hide",
        value: function hide() {
            this.itemElem.classList.add("hidden");
        }
    }]);

    return Item;
}();

function X(response) {
    var referenceItem = new Item(response.data.reference.item);
    var recommended = response.data.recommendation;
    init(referenceItem, recommended);
}

//TODO Create a namespace
var pages = void 0;
var pageSelected = 0;
var pageSize = 3;
var items = [];

var disable = function disable() {
    this.querySelector("i").classList.add("disabled");
};
var enable = function enable() {
    this.querySelector("i").classList.remove("disabled");
};

var prev = document.querySelector(".items__recommended__previous");
prev.onclick = function () {
    if (pageSelected !== 0) {
        for (var i = 0; i < items.length; i++) {
            items[i].hide();
        }

        pageSelected--;
        items.show(pageSelected);
        enableDisableNextPrevious();
    }
};
prev.disable = disable;
prev.enable = enable;

var next = document.querySelector(".items__recommended__next");
next.onclick = function () {
    if (pageSelected !== pages - 1) {
        for (var i = 0; i < items.length; i++) {
            items[i].hide();
        }

        pageSelected++;
        items.show(pageSelected);
        enableDisableNextPrevious();
    }
};
next.disable = disable;
next.enable = enable;

function init(referenceItem, recommendedItems) {
    document.querySelector(".items__reference").appendChild(referenceItem.itemElem);

    pages = Math.ceil(recommendedItems.length / pageSize);
    for (var i = 0; i < recommendedItems.length; i++) {
        var newItem = new Item(recommendedItems[i]);
        items.push(newItem);
        document.querySelector(".items__recommended").appendChild(newItem.itemElem);
    }

    referenceItem.show();
    items.show(0);

    spinner.hide();
    enableDisableNextPrevious();
}

items.show = function (index) {
    for (var i = 0; i < pageSize; i++) {
        if (typeof items[i + index * pageSize] !== "undefined") {
            items[i + index * pageSize].show();
        }
    }
};

var spinner = document.querySelector(".loading");
spinner.hide = function () {
    spinner.classList.add("hidden");
};
spinner.show = function () {
    spinner.classList.remove("hidden");
};

function enableDisableNextPrevious() {
    if (pages > 1) {
        if (pageSelected === 0) {
            prev.disable();
        } else {
            prev.enable();
            if (pageSelected === pages - 1) {
                next.disable();
            } else {
                next.enable();
            }
        }
    } else {
        prev.disable();
        next.disable();
    }
}